<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>PNEUMO</title>    
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.16.0/dist/tf.min.js"></script>
    <link rel="stylesheet" type="text/css" href="assets/styles.css">
    <link rel="stylesheet" type="text/css" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="assets/css/animate.min.css">
    <link rel="shortcut icon" href="Icons8-Ios7-Healthcare-Lungs.ico">
</head>

<body id="page-top" data-bs-spy="scroll" data-bs-target="#mainNav" data-bs-offset="77">
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const predictButton = document.getElementById('predictButton');
            predictButton.addEventListener('click', uploadAndPredict);
            var class_names = ['Bacterial Pneumonia', 'Normal', 'Viral Pneumonia'];

            async function preprocessImage(image) {
                const tensor = tf.browser.fromPixels(image);
                const resized = tf.image.resizeBilinear(tensor, [299, 299]);
                const normalized = resized.div(tf.scalar(255));
                return normalized.expandDims(0); // Add a batch dimension
            }

            async function predictImage(image, model) {
                const preprocessedImage = await preprocessImage(image);
                const predictions = await model.predict(preprocessedImage);
                const classIndex = predictions.argMax(1).dataSync()[0];
                const probability = predictions.dataSync()[0][classIndex];
                return { classIndex, probability };
            }

            async function uploadAndPredict() {
                console.log('Button clicked!');
                const loadedModel = await tf.loadLayersModel('model/model.json');
                console.log('Model loaded successfully!');
                const fileInput = document.getElementById('file');
                const file = fileInput.files[0];

                if (file) {
                    const reader = new FileReader();

                    reader.onload = async (e) => {
                        const loadedImage = new Image();
                        loadedImage.onload = async () => {
                            try {
                                const model = loadedModel;

                                if (model) {
                                    const predictionResult = await predictImage(loadedImage, model);
                                    const classLabel = class_names[predictionResult.classIndex];
                                    console.log(classLabel);
                                    document.getElementById('predictionText').textContent = `Prediction: ${classLabel}`;

                                    const probabilityElement = document.getElementById('predictionProbability');
                                    if (predictionResult.probability !== undefined) {
                                        const probabilityText = ` (Probability: ${predictionResult.probability.toFixed(4)})`;
                                        probabilityElement.textContent = probabilityText;
                                    } else {
                                        probabilityElement.textContent = ''; // Handle undefined probability
                                    }

                                    // Display the uploaded image
                                    const uploadedImageElement = document.getElementById('uploadedImage');
                                    uploadedImageElement.src = loadedImage.src;
                                    uploadedImageElement.style.display = 'block'; // Make sure the image is visible
                                } else {
                                    alert('Error loading model');
                                }
                            } catch (error) {
                                console.error('Error during prediction:', error);
                                alert('An error occurred during prediction');
                            }
                        };

                        loadedImage.src = e.target.result;
                    };

                    reader.readAsDataURL(file);
                }
            }
        });
    </script>
    <nav class="navbar navbar-expand-md fixed-top navbar-light" id="mainNav">
        <div class="container"><a class="navbar-brand" href="#">PNEUMO</a><button data-bs-toggle="collapse" class="navbar-toggler navbar-toggler-right" data-bs-target="#navbarResponsive" type="button" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation" value="Menu"><i class="fa fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item nav-link"><a class="nav-link active" data-bss-hover-animate="pulse" href="#about">About</a></li>
                    <li class="nav-item nav-link"><a class="nav-link" data-bss-hover-animate="pulse" href="#download" style="border-radius: 0;">Upload</a></li>
                    <li class="nav-item nav-link"><a class="nav-link" data-bss-hover-animate="pulse" href="#contact">contact</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <header class="masthead" id="masthead">
        <div class="intro-body">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <h1 class="brand-heading">PNEUMO</h1>
                        <p class="intro-text">Unlock the Power of Respiratory Well-being with PNEUMO! Dive into a world of knowledge, prioritize your lung health, and join us on a captivating journey towards a pneumonia-free future. Together, let's breathe easier and live life to the fullest. Your path to vibrant health starts here!</p><a class="btn btn-link bounce animated btn-circle" role="button" href="#about"><i class="fa fa-angle-double-down animated"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <section class="text-center content-section" id="about">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>About PNEUMO</h2>
                    <p>Welcome to <strong>PNEUMO</strong>, we're on a mission to demystify pneumonia, offering you a vibrant hub of information on its stages, symptoms, treatments, and preventative strategies. Empower yourself with insights, prioritize your respiratory health, and embark on a transformative journey towards a pneumonia-free future. Let's breathe freely and live life abundantly with <strong>PNEUMO</strong>!</p>
                </div>
            </div>
        </div>
    </section>
    <section class="text-center download-section content-section" id="download">
        <div class="container">
            <div class="col-lg-8 mx-auto">
                <h1>GO BOLDLY</h1>
                <p>Detecting pneumonia early is your ticket to resilience. Recognize the signs, seize control, and embark on your journey to recovery. Your body communicates—listen, act, and let early detection be the spark for your wellness journey. Face the challenge, armed with knowledge and determination. Cherish your health, protect it, and thrive.</p>
                <form id="uploadForm" method="POST" enctype="multipart/form-data">
                    <input class="btn btn-primary btn-lg btn-default" id="file" type="file" name="file" accept=".jpg, .jpeg, .png" required>
                    <button class="btn btn-primary btn-lg btn-default" id="predictButton" type="button">PREDICT</button>
                </form>

                <div id="predictionResult">
                    <h2 id="predictionText" style="color: rgb(66, 220, 163);"></h2>
                    <span id="predictionProbability"></span>
                    <!-- Display the uploaded image -->
                    <img id="uploadedImage" alt="Uploaded Image" style="display: none; max-width: 100%;" />
                </div>
            </div>
        </div>
    </section>
    <section class="text-center content-section" id="contact">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <h2>Contact us</h2>
                    <p>We value your health and well-being! If you have any questions, concerns, or simply want to share your thoughts on respiratory health, feel free to reach out to us. Your feedback is vital in helping us provide the most accurate and helpful information. Our dedicated team is here to assist you on your journey to better health. Together, let's foster a community that prioritizes respiratory wellness. Contact us today, because your health matters, and we're here to support you every step of the way.</p>
                    <ul class="list-inline banner-social-buttons">
                        <li class="list-inline-item">&nbsp;
                            <button class="btn btn-primary btn-lg github-button" type="button" onclick="redirectToGitHub()">
                                <i class="fa fa-github fa-fw"></i>
                                <span class="network-name">&nbsp;github</span>
                            </button>

                            <script>
                                function redirectToGitHub() {
                                    window.location.href = 'https://github.com/Abhiram-P-Ashok';
                                }
                            </script>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <p>Copyright ©&nbsp;Brand 2023</p>
    </section>
    <div class="map-clean"></div>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/bs-init.js"></script>
    <script src="assets/js/grayscale.js"></script>
    <!--<script src="assets/script.js"></script>-->
</body>
</html>
